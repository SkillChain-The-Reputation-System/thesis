\chapter{Hệ thống SkillChain}

\textbf{SkillChain} là một hệ thống ứng dụng mô hình uy tín phi tập trung dựa trên công nghệ chuỗi khối. Hệ thống cung cấp một môi trường làm việc xoay quanh các \textbf{thử thách}, cho phép người dùng tham gia để rèn luyện kỹ năng, trau dồi chuyên môn, củng cố kiến thức và đồng thời xây dựng hồ sơ uy tín một cách minh bạch, công khai và bất biến.
Bên cạnh đó, hệ thống thiết lập một cơ chế đánh giá công bằng, khách quan và được dẫn dắt bởi cộng đồng chuyên gia, nhằm đảm bảo rằng năng lực của người dùng được \textbf{ghi nhận đúng thực chất}, qua đó thúc đẩy động lực phát triển kỹ năng một cách bền vững và liên tục.

Ngoài việc hỗ trợ người học thể hiện năng lực thông qua hành động cụ thể, SkillChain còn cung cấp \textbf{công cụ xác thực đáng tin cậy} cho các nhà tuyển dụng trong việc đánh giá trình độ ứng viên --
vượt ra khỏi giới hạn của văn bằng, chứng chỉ hay khai báo chủ quan trong các mô hình tuyển dụng truyền thống.

\section{Yêu cầu chức năng chính}

\subsection{Chức năng của người dùng}

\textbf{Người dùng} là những cá nhân có nhu cầu xây dựng uy tín, chứng minh kỹ năng, trau dồi kiến thức và tìm kiếm cơ hội việc làm.
Một người dùng phổ thông có thể thực hiện các chức năng sau:

\begin{itemize}
  \item \textbf{Truy cập và quản lý thông tin cá nhân, hồ sơ uy tín}: Người dùng có thể truy cập vào trang thông tin cá nhân, tại đây họ được phép cập nhật các thông tin liên quan đến hồ sơ người dùng.
        Đồng thời, người dùng có thể xem chi tiết hồ sơ uy tín của bản thân, bao gồm điểm uy tín toàn cục và điểm uy tín chuyên môn theo từng lĩnh vực, tương ứng với các loại thử thách đã được liệt kê tại mục 3.1.
  \item \textbf{Xem danh sách thử thách đang hiện hành trên hệ thống}: Người dùng có thể xem danh sách các thử thách đang có trên hệ thống, bao gồm cả thông tin chi tiết về thử thách và người đóng góp tương ứng.
  \item \textbf{Tham gia thực hiện thử thách}: Sau khi lựa chọn một thử thách phù hợp, người dùng sẽ phải trả một khoản token cho người đóng góp để được tham gia (khoản token sẽ được tính toán bởi hệ thống). Hệ thống sẽ cung cấp một không gian làm việc riêng nhằm giải quyết yêu cầu của thử thách và cho phép tùy chỉnh giải pháp.
        Tuy nhiên, người đóng góp sẽ không thể tham gia thực hiện chính thử thách do mình đóng góp.
  \item \textbf{Nộp và gửi giải pháp}: Sau khi hoàn thành, người dùng có thể nộp và gửi giải pháp lên hệ thống để được đánh giá. Lúc này, giải pháp sẽ chuyển sang trạng thái \textit{chờ đánh giá} và không thể chỉnh sửa thêm.
        Bản thân người dùng không thể tham gia đánh giá giải pháp của chính mình.
  \item \textbf{Xem danh sách thử thách đã và đang thực hiện}: Người dùng có thể xem danh sách các thử thách mà mình đã hoặc đang tham gia cùng với các giải pháp tương ứng.
        Đối với những thử thách đã được đánh giá, hệ thống sẽ hiển thị danh sách người đánh giá và điểm số chi tiết của từng người.
  \item \textbf{Xem các bài tuyển dụng đang hiện hành}: Người dùng có thể xem danh sách các bài đăng tuyển dụng đang được đăng tải bởi các nhà tuyển dụng trên hệ thống, bao gồm đầy đủ thông tin chi tiết của từng bài đăng.
  \item \textbf{Tham gia ứng tuyển và phỏng vấn}: Người dùng có thể nộp đơn ứng tuyển cho các vị trí tuyển dụng nếu đáp ứng yêu cầu đề ra trong bài đăng.
        Sau khi ứng tuyển, người dùng sẽ chờ phản hồi từ phía nhà tuyển dụng. Trong trường hợp được chọn vào danh sách rút gọn, người dùng có thể tham gia phỏng vấn trực tuyến khi được nhà tuyển dụng lên lịch.
  \item \textbf{Xem danh sách các bài tuyển dụng đã và đang ứng tuyển}: Người dùng có thể theo dõi các bài tuyển dụng mà mình đã hoặc đang ứng tuyển, kèm theo trạng thái hiện tại của từng hồ sơ ứng tuyển (ví dụ: đang chờ phản hồi, đã được mời phỏng vấn, bị từ chối, v.v.).
\end{itemize}

Hệ thống còn mở rộng thêm các chức năng chuyên biệt theo vai trò cụ thể mà một người dùng phổ thông có thể sở hữu.

\subsubsection{Người đóng góp}

\textbf{Người đóng góp} là người dùng có vai trò tạo và thiết kế thử thách, đóng góp chúng vào ngân hàng thử thách chung của hệ thống. Một người đóng góp có thể thực hiện các chức năng sau:

\begin{itemize}
  \item \textbf{Tạo thử thách mới ở trạng thái nháp}: Mỗi thử thách bao gồm các thông tin bắt buộc như tiêu đề, loại thử thách, mô tả chi tiết, và mức token treo thưởng.
        Khi tạo thử thách, hệ thống cung cấp một không gian làm việc cho người đóng góp, cho phép chỉnh sửa nội dung trong giai đoạn nháp.
  \item \textbf{Gửi thử thách để kiểm duyệt}: Sau khi hoàn thiện nội dung, người đóng góp có thể gửi thử thách lên hệ thống để kiểm duyệt. Từ thời điểm này, thử thách chuyển sang trạng thái \textit{chờ kiểm duyệt} và không còn được chỉnh sửa.
        Người đóng góp không thể tham gia vào quá trình kiểm duyệt thử thách của chính mình.
  \item \textbf{Xem danh sách thử thách đã tạo}: Người đóng góp có thể xem danh sách các thử thách mà mình đã đóng góp. Đối với các thử thách đã được kiểm duyệt, có thể xem thông tin người kiểm duyệt, điểm đánh giá và mức thưởng token của từng người.
        Nếu thử thách đã được chấp nhận, người đóng góp cũng có thể xem danh sách người tham gia cùng với phần lợi nhuận thu được từ thử thách.
\end{itemize}

\subsubsection{Người kiểm duyệt}

\textbf{Người kiểm duyệt} là người dùng có vai trò đánh giá và phê duyệt chất lượng các thử thách được gửi từ phía người đóng góp. Một người kiểm duyệt có thể thực hiện các chức năng sau:

\begin{itemize}
  \item \textbf{Xem danh sách thử thách đang chờ kiểm duyệt}: Người kiểm duyệt có thể xem danh sách các thử thách đang ở trạng thái chờ phê duyệt, bao gồm thông tin chi tiết về thử thách và người đóng góp tương ứng.
  \item \textbf{Tham gia kiểm duyệt thử thách}: Sau khi lựa chọn một thử thách phù hợp, người kiểm duyệt có thể đăng ký tham gia vào quá trình đánh giá. Hệ thống sẽ cung cấp một không gian làm việc riêng để thực hiện quá trình kiểm duyệt.
  \item \textbf{Thực hiện kiểm duyệt thử thách}: Trong không gian làm việc, người kiểm duyệt có thể đánh giá nội dung thử thách và chấm điểm theo thang chuẩn của hệ thống. Sau khi gửi đánh giá, kết quả sẽ được ghi nhận vĩnh viễn và không thể chỉnh sửa.
  \item \textbf{Xem danh sách thử thách đã và đang kiểm duyệt}: Người kiểm duyệt có thể theo dõi danh sách các thử thách mà mình đã hoặc đang tham gia đánh giá.
        Đối với các thử thách đã hoàn tất kiểm duyệt, hệ thống sẽ hiển thị thông tin về các kiểm duyệt viên khác, điểm số đánh giá cũng như phần thưởng token được phân bổ cho từng người.
\end{itemize}

\subsubsection{Người đánh giá}

\textbf{Người đánh giá} là những người dùng có vai trò đánh giá và chấm điểm các giải pháp được gửi từ người dùng nói chung. Một người đánh giá có thể thực hiện các chức năng sau:

\begin{itemize}
  \item \textbf{Xem danh sách giải pháp đang chờ đánh giá}: Người đánh giá có thể xem danh sách các giải pháp đang ở trạng thái \textit{chờ đánh giá}. Tại thời điểm này, họ chỉ có thể xem nội dung thử thách và thông tin người gửi, nhưng chưa thể truy cập nội dung giải pháp.
  \item \textbf{Tham gia đánh giá giải pháp}: Sau khi lựa chọn một giải pháp phù hợp, người đánh giá có thể đăng ký tham gia vào quá trình đánh giá.
        Hệ thống sẽ cung cấp một không gian làm việc riêng để tiến hành việc đánh giá. Tuy nhiên, người đóng góp của thử thách không thể tham gia đánh giá giải pháp.
  \item \textbf{Thực hiện đánh giá giải pháp}: Trong không gian làm việc, người đánh giá sẽ được quyền xem nội dung giải pháp và tiến hành chấm điểm. Sau khi gửi đánh giá, kết quả sẽ được ghi nhận vĩnh viễn và không thể chỉnh sửa.
  \item \textbf{Xem danh sách giải pháp đã và đang đánh giá}: Người đánh giá có thể theo dõi danh sách các giải pháp mà mình đã hoặc đang tham gia đánh giá.
        Đối với các thử thách đã hoàn tất quá trình đánh giá, hệ thống sẽ hiển thị thông tin về các người đánh giá khác và điểm số tương ứng.
\end{itemize}

\subsection{Chức năng của nhà tuyển dụng}

\textbf{Nhà tuyển dụng} là chủ thể có nhu cầu tìm kiếm ứng viên, xác thực kỹ năng và đánh giá năng lực thông qua mô hình uy tín phi tập trung của hệ thống SkillChain.
Một nhà tuyển dụng có thể thực hiện các chức năng sau:

\begin{itemize}
  \item \textbf{Tạo bài tuyển dụng ở trạng thái nháp}: nhà tuyển dụng có thể khởi tạo một bài đăng tuyển dụng với các thông tin bắt buộc như: tiêu đề, mô tả công việc, yêu cầu công việc, khoảng thời gian làm việc, mức lương, thời điểm kết thúc ứng tuyển, và ngưỡng yêu cầu về uy tín chuyên môn.
        Ngoài ra, có thể bổ sung các thông tin tùy chọn như địa điểm làm việc hoặc yêu cầu về uy tín toàn cục. Bài đăng có thể được chỉnh sửa ở bất kỳ trạng thái nào.
  \item \textbf{Đăng bài tuyển dụng}: Sau khi hoàn thiện nội dung, nhà tuyển dụng có thể đăng bài lên hệ thống, qua đó cho phép người dùng đủ điều kiện ứng tuyển.
  \item \textbf{Xem thông tin ứng tuyển}: Đối với mỗi bài tuyển dụng, nhà tuyển dụng có thể xem danh sách các ứng viên đã ứng tuyển, bao gồm thông tin cá nhân và các chỉ số uy tín phù hợp với yêu cầu đề ra.
        Sau khi đánh giá, nhà tuyển dụng có thể thay đổi trạng thái ứng tuyển của từng ứng viên (ví dụ: từ ``đang chờ'' sang ``đã đánh giá'').
  \item \textbf{Lập lịch phỏng vấn}: Đối với các ứng viên nằm trong danh sách rút gọn, nhà tuyển dụng có thể tạo lịch hẹn phỏng vấn dưới hình thức buổi họp trực tuyến để đánh giá sâu hơn trước khi đưa ra quyết định cuối cùng.
\end{itemize}

\subsection{Chức năng của hệ thống}

Bên cạnh các chức năng được phân tách theo vai trò người dùng, hệ thống SkillChain cũng đảm nhận một tập hợp các chức năng nền tảng, đóng vai trò duy trì toàn bộ quá trình vận hành, lưu trữ, đánh giá và phân phối thông tin trong nền tảng. Cụ thể, hệ thống chịu trách nhiệm thực hiện các tác vụ sau:

\begin{itemize}
  \item \textbf{Lưu trữ và cập nhật dữ liệu}: Hệ thống có nhiệm vụ lưu trữ các dữ liệu do người dùng và nhà tuyển dụng tạo ra (bao gồm: thông tin cá nhân, thử thách, giải pháp, bài tuyển dụng, v.v.) trên cả nền tảng on-chain và off-chain. Bên cạnh đó, hệ thống cũng chịu trách nhiệm cập nhật các dữ liệu khi có thay đổi hợp lệ từ phía người dùng.
  \item \textbf{Truy xuất dữ liệu theo yêu cầu}: Hệ thống xử lý các yêu cầu truy vấn từ người dùng và nhà tuyển dụng, bao gồm việc lấy dữ liệu từ blockchain hoặc từ các nguồn lưu trữ off-chain, nhằm hiển thị thông tin một cách nhanh chóng và chính xác.
  \item \textbf{Quản lý phiên kiểm duyệt thử thách}: Hệ thống thu thập điểm kiểm duyệt từ tất cả các người kiểm duyệt tham gia một phiên kiểm duyệt, tính toán điểm chất lượng cuối cùng của thử thách, từ đó phân bổ phần thưởng token phù hợp và cập nhật điểm uy tín của từng người kiểm duyệt và người đóng góp.
  \item \textbf{Tính toán khoản token tham gia thử thách}: Hệ thống xác định mức phí token mà người tham gia cần chi trả để tham gia một thử thách, dựa trên thông tin cấu hình thử thách.
  \item \textbf{Quản lý phiên đánh giá giải pháp}: Hệ thống tổng hợp các điểm đánh giá từ các người đánh giá, tính toán điểm trung bình cuối cùng của giải pháp, và từ đó cập nhật điểm uy tín của cả người thực hiện giải pháp và người đánh giá.
  \item \textbf{Thống kê quá trình tuyển dụng}: Hệ thống tổng hợp dữ liệu từ các bài đăng, hồ sơ ứng tuyển, lịch phỏng vấn và kết quả tuyển dụng để cung cấp báo cáo thống kê cho nhà tuyển dụng, giúp đánh giá hiệu quả và chất lượng quy trình tuyển dụng của họ.
\end{itemize}

\section{Yêu cầu phi chức năng}

Bên cạnh các chức năng chính, hệ thống SkillChain cần đáp ứng một số yêu cầu phi chức năng để đảm bảo hiệu suất, khả năng sử dụng, bảo mật và độ tin cậy trong quá trình vận hành. Các yêu cầu này được liệt kê như sau:

\begin{itemize}
  \item \textbf{Tính minh bạch và bất biến}: Mọi hành vi quan trọng của người dùng như đóng góp thử thách, tham gia giải thử thách, đánh giá giải pháp hay kiểm duyệt chất lượng thử thách đều phải được ghi nhận on-chain nhằm đảm bảo tính minh bạch, công khai và không thể chỉnh sửa sau khi ghi nhận.
  \item \textbf{Tính bảo mật}: Thông tin tài khoản người dùng và dữ liệu nhạy cảm (ví dụ: dữ liệu giải pháp lưu trên nền tảng off-chain) cần được bảo vệ khỏi truy cập trái phép. Hệ thống phải xác thực danh tính người dùng thông qua ví tiền điện tử và chỉ cấp quyền tương ứng nếu có yêu cầu truy cập.
  \item \textbf{Tính khả dụng}: Hệ thống phải đảm bảo hoạt động liên tục, sẵn sàng phục vụ người dùng 24/7. Trong trường hợp một số dịch vụ off-chain bị gián đoạn, hệ thống vẫn cần đảm bảo dữ liệu on-chain có thể được truy xuất độc lập.
  \item \textbf{Khả năng mở rộng}: Hệ thống cần thiết kế để có thể mở rộng số lượng và số loại thử thách, người dùng và bài tuyển dụng trong tương lai mà không ảnh hưởng đến hiệu năng hoặc trải nghiệm người dùng.
  \item \textbf{Khả năng tương thích}: Ứng dụng cần tương thích với các trình duyệt phổ biến (Chrome, Firefox, Safari), ví tiền điện tử (MetaMask, CoinBase) và nhiều loại thiết bị điện tử (máy tính, máy tính bảng, điện thoại thông minh).
  \item \textbf{Khả năng sử dụng}: Giao diện người dùng cần trực quan, rõ ràng và dễ sử dụng đối với người dùng mới, đồng thời hỗ trợ đa vai trò với trải nghiệm nhất quán.
  \item \textbf{Hiệu suất hệ thống}: Thời gian phản hồi cho các thao tác phổ biến như truy xuất danh sách thử thách, nộp giải pháp, hay đánh giá thử thách không được vượt quá 3 giây trong điều kiện bình thường. Hệ thống cần tối ưu hóa việc đồng bộ dữ liệu giữa blockchain và phần giao diện.
  \item \textbf{Khả năng kiểm thử và bảo trì}: Hệ thống cần được xây dựng theo hướng mô-đun, dễ dàng kiểm thử và nâng cấp. Các thành phần frontend, backend, smart contract và dữ liệu lưu trữ cần được tách biệt rõ ràng.
\end{itemize}

\section{Các kịch bản sử dụng}

\subsection{Người đóng góp tạo thử thách}

Chị Linh là một người có kinh nghiệm trong lĩnh vực ``Quản trị cơ sở dữ liệu''. Sau một thời gian hoạt động tích cực trên nền tảng SkillChain, chị đã đạt chỉ số uy tín chuyên môn là 50 trong lĩnh vực này.
Hiện tại, chị có mong muốn đóng góp một thử thách chất lượng cho cộng đồng người học, đồng thời tìm kiếm cơ hội tạo thêm thu nhập thông qua nền tảng.

Chị điều hướng đến trang ``Tạo thử thách'', nơi người dùng có thể khởi tạo và công bố thử thách mới. Tại đây, chị tạo thử thách với tiêu đề ``Thiết kế cơ sở dữ liệu cho bệnh viện'' và đặt mức treo thưởng kiểm duyệt là 3 POL để thu hút sự tham gia của cộng đồng kiểm duyệt viên.
Sau khi hoàn tất các thông tin, hệ thống yêu cầu xác nhận giao dịch ký gửi 3 POL vào quỹ kiểm duyệt. Sau khi chị xác nhận giao dịch qua ví tiền điện tử, hệ thống chính thức khởi tạo một phiên kiểm duyệt thử thách, chờ cộng đồng chuyên gia tham gia đánh giá chất lượng.

\subsection{Người kiểm duyệt tham gia đánh giá thử thách}

Anh Hoàng là một chuyên gia trong lĩnh vực ``Trí tuệ nhân tạo'', hiện đang hoạt động trên nền tảng SkillChain với chỉ số uy tín chuyên môn đạt mức 250.
Với mong muốn đảm bảo chất lượng của các thử thách trên hệ thống, anh truy cập vào trang ``Các thử thách đang chờ kiểm duyệt'' để tìm kiếm các thử thách phù hợp với chuyên môn của mình. 
Tại đây, hệ thống hỗ trợ anh lọc danh sách thử thách theo lĩnh vực chuyên môn để thuận tiện hơn trong việc lựa chọn.

Sau khi xem xét nhiều thử thách, anh Hoàng quyết định tham gia kiểm duyệt thử thách có tiêu đề ``Phát triển Chatbot cho dịch vụ khách hàng'' với mức treo thưởng kiểm duyệt là 4 POL.
Anh nhấn nút ``Tham gia kiểm duyệt'', hệ thống yêu cầu anh xác nhận giao dịch qua ví tiền điện tử để hoàn tất thủ tục tham gia hội đồng kiểm duyệt. Sau khi giao dịch được xác thực thành công, hệ thống khởi tạo một không gian kiểm duyệt riêng, nơi anh có thể:

\begin{itemize}
  \item Thực hiện đánh giá thử thách theo thang điểm được chuẩn hóa của hệ thống;
  \item Đề xuất mức độ khó và thời gian giải trung bình dự kiến;
  \item Gửi kết quả kiểm duyệt và chờ hệ thống tổng hợp tất cả các đánh giá từ hội đồng kiểm duyệt.
\end{itemize}
Kết quả tổng hợp sẽ được sử dụng để xác định điểm chất lượng thử thách, đồng thời cập nhật chỉ số uy tín chuyên môn cho những người liên quan và phân phối thưởng cho các kiểm duyệt viên, bao gồm cả anh Hoàng.

\subsection{Người dùng tham gia thử thách}

Anh Đạt là một sinh viên theo học ngành Công nghệ thông tin và hiện đang quan tâm đến việc rèn luyện kỹ năng chuyên môn trong lĩnh vực An ninh mạng. 
Anh truy cập vào hệ thống SkillChain, kết nối ví tiền điện tử của mình và điều hướng đến trang ``Khám phá'' để tìm kiếm những thử thách phù hợp với năng lực hiện tại.

Sau khi xem qua nhiều thử thách, anh Đạt quyết định chọn thử thách có tên ``Hệ thống xác thực sinh trắc học''. Đây là một thử thách thuộc lĩnh vực An ninh mạng, có độ khó trung bình và điểm chất lượng là 91.
Anh nhấn nút ``Tham gia'', hệ thống yêu cầu xác nhận giao dịch chuyển 0.03 POL từ ví của anh sang ví của người đóng góp thử thách. 
Sau khi anh xác nhận giao dịch thành công, hệ thống tạo một không gian làm việc cá nhân hóa, nơi anh có thể tải đề bài, tiến hành giải bài và nộp giải pháp khi hoàn tất.

\subsection{Người đánh giá tham gia đánh giá giải pháp}

Anh Tuyên là một chuyên gia trong lĩnh vực Phát triển phần mềm, đang hoạt động trên nền tảng SkillChain với chỉ số uy tín chuyên môn là 180. 
Với mong muốn đóng góp vào quá trình xác thực kỹ năng cho cộng đồng người học, anh truy cập vào hệ thống và chuyển đến trang ``Các giải pháp đang chờ đánh giá''.

Tại đây, hệ thống liệt kê danh sách các giải pháp, hỗ trợ anh lọc các giải pháp thuộc lĩnh vực chuyên môn của anh. 
Sau khi xem qua nhiều giải pháp khác nhau, anh Tuyên quyết định chọn đánh giá giải pháp của thử thách ``Phát triển ứng dụng soạn thảo văn bản'', một thử thách có độ khó trung bình và điểm chất lượng là 88.

Anh nhấn nút ``Tham gia đánh giá'', hệ thống yêu cầu anh xác nhận giao dịch qua ví tiền điện tử để hoàn tất thủ tục đăng ký tham gia hội đồng đánh giá. 
Sau khi giao dịch được xác thực thành công, hệ thống tiến hành cấp quyền truy cập và khởi tạo không gian đánh giá riêng, nơi anh có thể:

\begin{itemize}
  \item Xem nội dung chi tiết của giải pháp
  \item Thực hiện việc chấm điểm theo thang điểm hệ thống
  \item Gửi đánh giá cuối cùng cho hệ thống, chờ hệ thống tổng hợp tất cả điểm của những người đánh giá khác và cập nhật điểm uy tín chuyên môn cho người giải và từng người đánh giá, bao gồm của bản thân anh.
\end{itemize}

\subsection{Nhà tuyển dụng tìm kiếm ứng viên}

Chị Nga là một nhân viên quản lý nhân sự của công ty X, hiện đang có nhu cầu tuyển dụng ứng viên thông qua nền tảng SkillChain. 
Chị truy cập hệ thống và thực hiện ký gửi 5 POL để hệ thống cấp quyền hoạt động như một nhà tuyển dụng.

Tại trang ``Công việc'', chị Nga tạo và đăng tải một bài tuyển dụng với tiêu đề ``Chuyên gia quản trị mạng'', trong đó yêu cầu ứng viên có chỉ số uy tín chuyên môn đạt ít nhất 180 trong lĩnh vực ``Quản trị mạng'' và 190 trong lĩnh vực ``An ninh mạng''.
Sau một khoảng thời gian, bài tuyển dụng nhận được 5 hồ sơ ứng tuyển. Chị Nga tiến hành đánh giá hồ sơ của từng ứng viên, sau đó lập lịch cuộc họp trực tuyến với các ứng viên tiềm năng để phỏng vấn chuyên sâu. 
Cuối cùng, chị xác nhận với hệ thống về việc tuyển thành công một ứng viên phù hợp.

\section{Kiến trúc hệ thống}

Hệ thống SkillChain được xây dựng theo mô hình ứng dụng phi tập trung, kết hợp giữa các công nghệ frontend hiện đại, hợp đồng thông minh trên blockchain và các dịch vụ tương tác ngoài chuỗi.
Kiến trúc tổng thể bao gồm bốn thành phần chính: giao diện người dùng, tương tác ví và blockchain, hệ thống hợp đồng thông minh và các dịch vụ bên ngoài.
Hình~\ref{fig:system-architecture} minh họa kiến trúc tổng quát của hệ thống.

\begin{figure}[H]
  \centering
  \begin{tikzpicture}
    \tikzset{
      pics/cylinder/.style={
          code={
              \draw[thick] (0,0) ellipse (1.3 and 0.3);

              \draw[thick] (-1.3,0) -- (-1.3,-1.2);
              \draw[thick] (1.3,0) -- (1.3,-1.2);

              \draw[thick] (-1.3,-1.2) arc (180:360:1.3 and 0.3);

              \node at (0,-0.85) {\footnotesize Vercel Hosting};
            }
        }
    }
    \node[draw, thick, rectangle, minimum width=2cm, minimum height=1cm, font=\footnotesize] (user) at (0, 0) {User};
    \pic (vercel) at (0, -2) {cylinder};
    \node (vercel_north) at (0, -1.85) {};
    \node (vercel_south) at (0, -3.3) {};

    \node[draw, thick, rectangle, minimum width=2.7cm, minimum height=1cm, font=\footnotesize] (nextjs) at (0, -5.5) {NextJS App};
    \node[draw, thick, rectangle, minimum width=3cm, minimum height=1cm, font=\footnotesize] (tailwindcss) at (4.5, -4.5) {Tailwind CSS};

    \node[draw, thick, rectangle, minimum width=5.8cm, minimum height=2.3cm, font=\footnotesize] (externalservice) at (4.9, -8) {};
    \node[font=\footnotesize] at ([yshift=-0.4cm]externalservice.north) {External Services};
    \node[draw, thick, rectangle, minimum width=2.5cm, minimum height=1cm, font=\footnotesize] (jitsimeet) at ([xshift=1.65cm, yshift=-0.15cm]externalservice.west) {Jitsi Meet};
    \node[draw, thick, rectangle, minimum width=2cm, minimum height=1cm, font=\footnotesize] (irys) at ([xshift=-1.5cm, yshift=-0.15cm]externalservice.east) {Irys};

    \node[draw, thick, rectangle, minimum width=5cm, minimum height=4.5cm, font=\footnotesize] (devinfrastructure) at (-5, -5) {};
    \node[font=\footnotesize] at ([yshift=-0.4cm]devinfrastructure.north) {Development Infrastructure};
    \node[draw, thick, rectangle, minimum width=2.5cm, minimum height=1cm, font=\footnotesize] (nodejs) at ([yshift=-1.5cm]devinfrastructure.north) {NodeJS};
    \node[draw, thick, rectangle, minimum width=2.5cm, minimum height=1cm, font=\footnotesize] (hardhat) at ([yshift=1cm]devinfrastructure.south) {Hardhat};

    \node[draw, thick, rectangle, minimum width=6.2cm, minimum height=2.3cm, font=\footnotesize] (network) at (-5, -12) {};
    \node[font=\footnotesize] at ([yshift=-0.4cm]network.north) {Blockchain Networks};
    \node[draw, thick, rectangle, minimum width=2.7cm, minimum height=1cm, font=\footnotesize] (amoytestnet) at ([xshift=1.65cm, yshift=-0.2cm]network.west) {Polygon Amoy};
    \node[draw, thick, rectangle, minimum width=2.5cm, minimum height=1cm, font=\footnotesize] (localhost) at ([xshift=-1.65cm, yshift=-0.2cm]network.east) {Local Host};

    \node[draw, thick, rectangle, minimum width=3.5cm, minimum height=1cm, font=\footnotesize] (smartcontracts) at (-5, -9) {Smart Contracts};
    \node[draw, thick, rectangle, minimum width=2cm, minimum height=1cm, font=\footnotesize] (wagmi) at (0, -9) {Wagmi};
    \node[draw, thick, rectangle, minimum width=2.7cm, minimum height=1cm, font=\footnotesize] (connectkit) at (1.2, -12) {ConnectKit};
    \node[draw, thick, rectangle, minimum width=3cm, minimum height=1cm, font=\footnotesize] (cryptowallet) at (5.5, -12) {Crypto Wallets};

    \draw[-latex, thick] (user.south) -- (vercel_north);
    \draw[-latex, thick] (vercel_south) -- (nextjs.north);
    \draw[-latex, thick] ([yshift=0.1cm]nextjs.east) -- (tailwindcss.west);
    \draw[-latex, thick] ([yshift=0.2cm]nextjs.south east) -- ([xshift=-2cm]externalservice.north);
    \draw[-latex, thick] (nextjs.south) -- (wagmi.north);
    \draw[-latex, thick] (wagmi.south) -- (connectkit.north);
    \draw[-latex, thick] (connectkit.east) -- (cryptowallet.west);
    \draw[-latex, thick] (nodejs.south) -- (hardhat.north);
    \draw[-latex, thick] (wagmi.west) -- (smartcontracts.east);
    \draw[-latex, thick] (devinfrastructure.south) -- (smartcontracts.north);
    \draw[-latex, thick] (smartcontracts.south) -- (network.north);
  \end{tikzpicture}
  \caption{Sơ đồ kiến trúc hệ thống}
  \label{fig:system-architecture}
\end{figure}

\subsection{Thành phần giao diện người dùng}

Giao diện người dùng được phát triển bằng framework \textbf{NextJS} và triển khai trên nền tảng \textbf{Vercel}, hỗ trợ hiệu năng cao và dễ dàng mở rộng.
Giao diện sử dụng \textbf{Tailwind CSS} để xây dựng UI hiện đại, tối ưu cho trải nghiệm người dùng. Toàn bộ tương tác của người dùng với hệ thống (tham gia thử thách, gửi giải pháp, truy xuất hồ sơ uy tín...) đều diễn ra thông qua lớp này.

\subsection{Tương tác với blockchain}

Để frontend tương tác với blockchain, hệ thống sử dụng thư viện \textbf{Wagmi} kết hợp với \textbf{ConnectKit} giúp tích hợp ví tiền điện tử như MetaMask hoặc CoinBase.
Các chức năng như xác thực người dùng qua ví, gửi giao dịch on-chain, theo dõi sự kiện blockchain đều được xử lý tại đây.

\subsection{Hợp đồng thông minh và hạ tầng blockchain}

Các hợp đồng thông minh được phát triển bằng \textbf{Solidity}, biên dịch và triển khai thông qua \textbf{Hardhat}. Trong quá trình phát triển và thử nghiệm, hệ thống hỗ trợ triển khai trên mạng cục bộ và mạng thử nghiệm \textbf{Polygon Amoy}.
Các chức năng chính của smart contract bao gồm: quản lý thử thách, giải pháp và thông tin tuyển dụng, quản lý thông tin cá nhân và hồ sơ uy tín của người dùng và nhà tuyển dụng, kiểm soát truy cập.

\subsection{Các dịch vụ bên ngoài}

Một số loại dữ liệu không phù hợp để lưu trực tiếp trên chuỗi như nội dung thử thách hoặc giải pháp sẽ được lưu trữ trên \textbf{Irys}, với CID được lưu lại trên blockchain để dễ dàng tham chiếu.
Ngoài ra, hệ thống còn tích hợp \textbf{Jitsi Meet} để phục vụ việc tổ chức các buổi phỏng vấn trực tuyến giữa nhà tuyển dụng và ứng viên, đảm bảo tính riêng tư và tiện lợi.

% // TODO: ☑️ Ghi nội dung sau khi có sơ đồ

\section{Mô hình dữ liệu}

\begin{figure}[H]
  \centering
  \includegraphics[width=0.95\textwidth]{../images/ERD.png}
  \caption{Sơ đồ mô hình dữ liệu (ERD) của hệ thống SkillChain}
  \label{fig:erd}
\end{figure}

\subsection{Quan hệ giữa User, Challenge, ModeratorReview, ReviewPool, Pot và ChallengeRevenue}
  \begin{figure}[H]
    \centering
    \includegraphics[width=0.95\textwidth]{../images/ERD-sub1.png}
    \caption{Mô hình dữ liệu (ERD) giữa các thực thể User, Challenge, ModeratorReview, ReviewPool, Pot và ChallengeRevenue}
    \label{fig:erd-sub1}
  \end{figure}

  \paragraph{Mô tả các thực thể}

    \begin{itemize}
      \item \textbf{User}: Đại diện cho tài khoản người dùng trên hệ thống, với \texttt{address} làm khóa chính và \texttt{data\_id} là biến tham chiếu dữ liệu off-chain.
      \item \textbf{Challenge}: Mỗi thử thách được xác định bởi \texttt{id} theo kiểu dữ liệu \texttt{bytes32}, bao gồm các trường thông tin: tham chiếu đến dữ liệu off-chain, lĩnh vực, thời điểm đóng góp, số lượng người đã tham gia, điểm chất lượng, độ khó thời gian giải ước tính và trạng thái. Khóa ngoại \texttt{contributor} liên kết đến \texttt{User.address}.
      \item \textbf{ModeratorReview}: Lưu trữ lượt đánh giá của moderator với khoá chính ghép (\texttt{moderator}, \texttt{challenge\_id}),bao gồm thời gian, tham chiếu đến dữ liệu off-chain, các câu trả lời về yếu tố chất lượng, đề xuất siêu dữ liệu (metadata) mới và điểm chất lượng đề xuất.
      \item \textbf{ReviewPool}: Quản lý các bài đánh giá cho mỗi thử thách. Sử dụng \texttt{challenge\_id} làm khóa chính và cờ \texttt{is\_finalized} để đánh dấu khi đối tượng này (pool) đã trải qua quá trình tổng hợp các bài đánh giá hay chưa.
      \item \textbf{Pot}: Quản lý quỹ thưởng của thử thách, bao gồm số token người đóng góp chi, tổng quỹ thưởng và cờ đánh dấu quỹ đã phân phát đến những người kiểm duyệt hay chưa. Khóa chính là \texttt{challenge\_id}.
      \item \textbf{ChallengeRevenue}: Theo dõi tổng doanh thu của mỗi thử thách, với \texttt{challenge\_id} làm khóa chính.
    \end{itemize}

  \paragraph{Mối quan hệ chính}

    \begin{itemize}
      \item Một \textbf{User} có thể đóng góp nhiều \textbf{Challenge}.
      \item Mỗi \textbf{Challenge} tạo ra một \textbf{ReviewPool} duy nhất và có thể có nhiều lượt \textbf{ModeratorReview}.
      \item Một \textbf{ModeratorReview} luôn liên kết với một \textbf{ReviewPool} và một \textbf{Challenge}.
      \item Một \textbf{User} (với vai trò moderator) có thể thực hiện nhiều \textbf{ModeratorReview}.
      \item Mỗi \textbf{Challenge} có một \textbf{Pot} thưởng và một \textbf{ChallengeRevenue}.
    \end{itemize}


\subsection{Quan hệ giữa User, Challenge, Solution, EvaluationPool và Evaluation}

  \begin{figure}[H]
    \centering
    \includegraphics[width=0.6\textwidth]{../images/ERD-sub2.png}
    \caption{Mô hình dữ liệu (ERD) giữa các thực thể User, Challenge, Solution, EvaluationPool và Evaluation}
    \label{fig:erd-sub2}
  \end{figure}

  \paragraph{Mô tả các thực thể}

    \begin{itemize}
      \item \textbf{Solution}: Giải pháp mà người dùng gửi cho một thử thách, với \texttt{id} làm khóa chính. Các thuộc tính bao gồm \texttt{user} (khóa ngoại đến \texttt{User.address}), \texttt{challenge\_id} (khóa ngoại đến \texttt{Challenge.id}), tham chiếu đến dữ liệu off-chain \texttt{solution\_txid}, thời gian tạo (\texttt{created\_at}), thời gian nộp (\texttt{submitted\_at}), tiến độ (\texttt{progress}) và điểm đánh giá trung bình (\texttt{score}).
      \item \textbf{EvaluationPool}: Quản lý những người đánh giá tham gia vào phiên đánh giá của một giải pháp và các bài đánh giá tương ứng, bao gồm các thuộc tính \texttt{solution\_id} làm khóa chính, tổng số lượng người đánh giá, số lượng bài đánh giá và thời điểm hoàn thành quá trình tổng hợp đánh giá (\texttt{completed\_at}).
      \item \textbf{Evaluation}: Mỗi lượt đánh giá của một người đánh giá đối với một giải pháp, khóa chính ghép là (\texttt{solution\_id}, \texttt{evaluator}). Các thuộc tính bao gồm điểm đánh giá đề xuất cho giải pháp và thời gian nộp.
    \end{itemize}

  \paragraph{Mối quan hệ chính}
    \begin{itemize}
      \item Một \textbf{User} có thể giải nhiều \textbf{Solution} (solves).
      \item Một \textbf{Challenge} có thể chứa nhiều \textbf{Solution} (contains).
      \item Mỗi \textbf{Solution} gắn với đúng một \textbf{EvaluationPool} (has).
      \item \textbf{EvaluationPool} có thể chứa nhiều lượt \textbf{Evaluation} (contains).
      \item Một \textbf{User} trong vai trò người  có thể thực hiện nhiều bài đánh giá \textbf{Evaluation} (evaluates).
    \end{itemize}


\subsection{Quan hệ giữa User, RecruiterProfile, Job, Application và Meeting}

  \begin{figure}[H]
    \centering
    \includegraphics[width=0.6\textwidth]{../images/ERD-sub3.png}
    \caption{Mô hình dữ liệu (ERD) giữa các thực thể User, RecruiterProfile, Job, Application và Meeting}
    \label{fig:erd-sub3}
  \end{figure}

  \paragraph{Mô tả các thực thể}

    \begin{itemize}
      \item \textbf{RecruiterProfile}: Hồ sơ nhà tuyển dụng, với \texttt{recruiter\_address} là khóa chính và \texttt{data\_id} là biến tham chiếu nội dung chi tiết được trữ off-chain.
      \item \textbf{Job}: Công việc do nhà tuyển dụng đăng, xác định bởi \texttt{id} kiểu \texttt{bytes32}. Thuộc tính bao gồm \texttt{recruiter}, \texttt{content\_id} (tham chiếu nội dung mô tả công việc được lưu trữ off-chain), thời gian tạo (\texttt{created\_at}) và trạng thái (\texttt{status}).
      \item \textbf{Application}: Đơn ứng tuyển cho một công việc, với \texttt{id} làm khóa chính. Gồm \texttt{job\_id} (khóa ngoại đến \texttt{Job.id}), \texttt{applicant} (khóa ngoại đến \texttt{User.address}), thời gian nộp (\texttt{applied\_at}) và trạng thái (\texttt{status}).
      \item \textbf{Meeting}: Cuộc hẹn phỏng vấn cho một đơn ứng tuyển, với \texttt{id} làm khóa chính. Các thuộc tính gồm \texttt{application\_id} (khóa ngoại đến \texttt{Application.id}), tham chiếu đến dữ liệu off-chain (\texttt{txid}), trạng thái (\texttt{status}), thời điểm bắt đầu (\texttt{created\_at}) và kết thúc (\texttt{ended\_at}).
    \end{itemize}

  \paragraph{Mối quan hệ chính}
    \begin{itemize} 
      \item Một \textbf{RecruiterProfile} có thể đăng nhiều \textbf{Job} (\emph{posts}).
      \item Một \textbf{Job} có thể nhận nhiều \textbf{Application} (\emph{receives}).
      \item Một \textbf{User} có thể nộp nhiều \textbf{Application} (\emph{applies}).
      \item Mỗi \textbf{Application} có thể lên lịch nhiều \textbf{Meeting} (\emph{schedules}).
    \end{itemize}


\subsection{Quan hệ giữa RecruiterProfile, User, PaymentRecord và Reputation}

  \begin{figure}[H]
    \centering
    \includegraphics[width=0.9\textwidth]{../images/ERD-sub4.png}
    \caption{Mô hình dữ liệu (ERD) giữa các thực thể RecruiterProfile, User, PaymentRecord và Reputation}
    \label{fig:erd-sub4}
  \end{figure}

  \paragraph{Mô tả các thực thể}

    \begin{itemize}
      \item \textbf{PaymentRecord}: Bản ghi thanh toán phí tuyển dụng mỗi khi nhà tuyển dụng tuyển một ứng cử viên, xác định bởi \texttt{recordId} kiểu \texttt{bytes32}. Các thuộc tính bao gồm \texttt{recruiter} là khóa ngoại đến \texttt{RecruiterProfile.recruiter\_address}, \texttt{applicant} là khóa ngoại đến \texttt{User.address}, \texttt{amount} (số tiền) và \texttt{timestamp} (thời gian giao dịch).
      \item \textbf{Reputation}: Điểm uy tín của người dùng theo từng lĩnh vực, với khóa chính tổng hợp (\texttt{user}, \texttt{domain}). Thuộc tính bao gồm điểm uy tín chuyên môn \texttt{domain\_reputation} và điểm uy tín toàn cục \texttt{global\_reputation}.
    \end{itemize}

  \paragraph{Mối quan hệ chính}
    \begin{itemize}
      \item Một \textbf{RecruiterProfile} có thể tạo nhiều \textbf{PaymentRecord} (\emph{makes}).
      \item Một \textbf{User} có thể xuất hiện trong nhiều \textbf{PaymentRecord} với vai trò ứng viên (\emph{contains}).
      \item Một \textbf{User} có thể có nhiều \textbf{Reputation} theo các lĩnh vực khác nhau (\emph{has}).
    \end{itemize}

\section{Chi tiết các hợp đồng thông minh}

\subsection{Danh sách các hợp đồng chính}

Hệ thống SkillChain được tổ chức thành nhiều hợp đồng thông minh độc lập theo nguyên tắc phân tách trách nhiệm. Mỗi hợp đồng đảm nhiệm một vai trò riêng trong hệ thống và được triển khai độc lập để tăng khả năng bảo trì, tái sử dụng và kiểm soát truy cập. Dưới đây là danh sách các hợp đồng chính trong hệ thống:

\begin{itemize}
  \item \textbf{UserDataManager}: Quản lý thông tin cá nhân và định danh người dùng.
  \item \textbf{ReputationManager}: Lưu trữ và cập nhật hồ sơ uy tín của người dùng, bao gồm điểm uy tín toàn cục và điểm uy tín chuyên môn theo từng lĩnh vực. Hợp đồng này là trung tâm của hệ thống uy tín.
  \item \textbf{ChallengeManager}: Quản lý vòng đời của thử thách, từ khởi tạo, kiểm duyệt đến cho phép người dùng tham gia.
  \item \textbf{ModerationEscrow}: Điều phối việc phân phối phần thưởng token cho những người kiểm duyệt thử thách sau khi quá trình kiểm duyệt hoàn tất.
  \item \textbf{ChallengeCostManager}: Tính toán mức phí mà người dùng cần chi trả để tham gia vào một thử thách cụ thể.
  \item \textbf{SolutionManager}: Quản lý quá trình người dùng thực hiện và gửi giải pháp cho thử thách, ghi nhận hành vi nộp bài, và xử lý luồng đánh giá bởi các người đánh giá.
  \item \textbf{RecruiterDataManager}: Quản lý thông tin tài khoản nhà tuyển dụng.
  \item \textbf{RecruiterSubscription}: Kiểm soát việc thanh toán phí đăng ký theo chu kỳ từ phía nhà tuyển dụng để có quyền đăng bài tuyển dụng trên hệ thống.
  \item \textbf{JobManager}: Lưu trữ và quản lý các bài đăng tuyển dụng.
  \item \textbf{JobApplicationManager}: Ghi nhận và quản lý thông tin ứng tuyển của người dùng cho từng bài đăng cụ thể.
  \item \textbf{MeetingManager}: Tổ chức và lưu trữ lịch họp trực tuyến giữa nhà tuyển dụng và ứng viên.
  \item \textbf{RoleManager}: Phân quyền hệ thống, kiểm soát ai được phép gọi các chức năng đặc biệt. Hợp đồng này đảm bảo an toàn và tách biệt vai trò trong hệ thống.
\end{itemize}

\subsection{ReputationManager}

Hợp đồng \textbf{ReputationManager} chịu trách nhiệm duy trì, cập nhật và điều chỉnh các chỉ số uy tín của người dùng theo từng lĩnh vực chuyên môn cũng như tổng điểm uy tín toàn cục.
Đây là thành phần cốt lõi để xác định vai trò, quyền truy cập và độ tin cậy của người tham gia trên nền tảng SkillChain.

\subsubsection{Chức năng chính}

\begin{itemize}
  \item Ghi nhận và duy trì điểm uy tín theo từng lĩnh vực chuyên môn và tổng uy tín toàn cục.
  \item Tính toán và cập nhật sự thay đổi uy tín dựa trên hành vi của người dùng trong các vai trò người giải thử thách, người đóng góp, người kiểm duyệt và người đánh giá giải pháp. Cơ chế cập nhật đã được giải thích chi tiết tại mục 3.2.
  \item Tự động cấp hoặc thu hồi vai trò tùy theo mức uy tín đạt được.
\end{itemize}

\subsubsection{Các hàm chức năng chính}

\begin{itemize}
  \item \texttt{updateSolvingProblemReputation}: cập nhật uy tín người giải thử thách sau khi giải pháp đã được đánh giá
  \item \texttt{updateEvaluateSolutionReputation}: cập nhật uy tín người đánh giá giải pháp sau khi phiên đánh giá kết thúc
  \item \texttt{updateContributionReputation}: cập nhật uy tín người đóng góp sau khi thử thách đã được duyệt xong
  \item \texttt{updateModerationReputation}: cập nhật uy tín người kiểm duyệt sau khi phiên kiểm duyệt hoàn tất
\end{itemize}

\subsubsection{Tương tác với hợp đồng khác}

\begin{itemize}
  \item \textbf{RoleManager}: Cấp hoặc thu hồi vai trò sau khi uy tín thay đổi
  \item \textbf{ChallengeManager}: Cập nhật uy tín sau khi phiên kiểm duyệt thử thách hoàn tất
  \item \textbf{SolutionManager}: Cập nhật uy tín sau khi phiên đánh giá giải pháp kết thúc
\end{itemize}

% // TODO: Giải thích về RoleManager nếu cần thiết

\subsection{ChallengeManager}

Hợp đồng \textbf{ChallengeManager} đóng vai trò trung tâm trong quá trình quản lý các thử thách kỹ năng trong hệ thống SkillChain.
Hợp đồng này chịu trách nhiệm cho toàn bộ vòng đời của một thử thách -- từ khởi tạo, đóng góp, kiểm duyệt cho đến tham gia thử thách và cập nhật dữ liệu uy tín.

\subsubsection{Chức năng chính}

\begin{itemize}
  \item Cho phép người đóng góp tạo và gửi thử thách cho bên kiểm duyệt
  \item Cho phép người kiểm duyệt tham gia kiểm duyệt và đánh giá chất lượng thử thách
  \item Hợp nhất kết quả kiểm duyệt theo mô hình có trọng số dựa trên uy tín, từ đó phân phối token cho bên kiểm duyệt và cập nhật uy tín cho người đóng góp và từng người kiểm duyệt
  \item Cho phép người dùng tham gia thử thách, hỗ trợ tính toán lượng token cần phải trả cho người đóng góp để tham gia
\end{itemize}

\subsubsection{Cấu trúc dữ liệu chính}

\begin{itemize}
  \item \texttt{Challenge}: chứa thông tin đầy đủ của một thử thách
  \item \texttt{ModeratorReview}: ghi nhận đánh giá của từng người kiểm duyệt đối với một thử thách
  \item \texttt{ReviewPool}: tập hợp những người kiểm duyệt tham gia vào một thử thách và trạng thái kiểm duyệt
  \item \texttt{JoinedChallenges}: ghi nhận thử thách mà người dùng đã và đang tham gia giải
\end{itemize}

\subsubsection{Các hàm chức năng chính}

\paragraph{Quản lý thử thách}

\begin{itemize}
  \item \texttt{createChallenge}: Người dùng có đủ quyền đóng góp trong một lĩnh vực chuyên môn có thể khởi tạo thử thách nháp
  \item \texttt{contributeChallenge}: Người đóng góp chính thức gửi thử thách cho bên kiểm duyệt, đính kèm mức token treo thưởng.
\end{itemize}

\paragraph{Kiểm duyệt thử thách}

\begin{itemize}
  \item \texttt{joinReviewPool}: Cho phép người kiểm duyệt hợp lệ tham gia vào phiên kiểm duyệt
  \item \texttt{submitModeratorReview}: Gửi đánh giá chất lượng thử thách, tính điểm theo các yếu tố chất lượng
  \item \texttt{finalizeChallenge}: Khi đủ số lượng đánh giá, hợp nhất kết quả yếu tố chất lượng, xác định mức độ khó, tính thời gian giải ước tính, tính điểm chất lượng, cập nhật uy tín và phân phối token.
\end{itemize}

\paragraph{Người dùng tham gia thử thách}

\begin{itemize}
  \item \texttt{userJoinChallenge}: Người dùng trả phí token, tham gia thử thách và khởi tạo không gian giải pháp
  \item \texttt{userCompleteChallenge}: Cập nhật số người hoàn thành
\end{itemize}

% // TODO: ☑️ Giải thích cách tổng hợp kết quả kiểm duyệt
\subsubsection{Cơ chế hợp nhất kết quả kiểm duyệt}

Giả sử $D$ là tập hợp mức độ khó của thử thách (dễ, trung bình, khó), $F$ là tổng số lượng các yếu tổ chất lượng dùng để đánh giá thử thách, $M$ là tập hợp những người kiểm duyệt đánh giá một thử thách. Với mỗi người kiểm duyệt $m \in M$, ta có:
\begin{itemize}
  \item $d_m$ là độ khó đã đề xuất
  \item $t_m$ là thời gian giải ước tính đã đề xuất
  \item $q_{mf}$ là đánh giá của người kiếm duyệt đối với một yếu tố chất lượng, mang một trong hai ý nghĩa: Đúng hoặc Sai, $q_{mf} \in \{0,1\}$
  \item $w_m$ là trọng số uy tín của người kiểm duyệt dựa trên điểm uy tín chuyên môn $R_{i}$ của họ trong lĩnh vực của thử thách
  \[w_m = R_{i}\]
\end{itemize}

\paragraph{Xác định mức độ khó}
\begin{itemize}
  \item Để xác định mức độ khó của thử thách, hệ thống sử dụng cơ chế biểu quyết theo số đông dựa trên trọng số. Hệ thống lần lượt tính tổng trọng số $W(d)$ của từng mức độ khó $d \in D$ theo công thức:
    \[W(d) \;=\; \sum_{m \in M} w_m \cdot \mathbf{1}\big(d_m = d\big)\]
  \item Sau cùng, mức độ khó nào có tổng trọng số cao nhất sẽ là mức độ khó của thử thách:
    \[d_{\text{final}} \;=\; \underset{d \in D}{\operatorname{arg\,max}}\; W(d)\]
\end{itemize}

\paragraph{Tính thời gian giải ước tính}
\begin{itemize}
  \item Thời gian giải ước tính của thử thách là trung bình có trọng số của thời gian giải ước tính đã đề xuất $t_{m}$ và trọng số uy tín $w_m$ của người kiểm duyệt tương ứng:
    \[T_{\text{final}}= \frac{\displaystyle\sum_{m=1}^{M} (w_{m}*t_{m})}{\displaystyle\sum_{m=1}^{M} w_{m}}\]
\end{itemize}

\paragraph{Tính điểm chất lượng}
\begin{itemize}
  \item Người kiểm duyệt đánh giá thử thách bằng cách trả lời $F$ yếu tố chất lượng đã được hệ thống quy định sẵn. Sau khi nộp bài đánh giá, hệ thống tính điểm chất lượng đề xuất của từng người kiểm duyệt theo công thức: 
    \[q_{\text{m}}=\frac{100}{F} \sum_{f=1}^{F} q_{mf} \in[0,100]\]
  \item Điểm chất lượng của thử thách được tổng hợp dựa trên điểm chất lượng đề xuất của những người kiểm duyệt tham gia vào phiên kiểm duyệt:
    \[Q_{\text{challenge}}=\frac{\sum_{m=1}^{M} w_m q_{\text{m}}}{\sum_{m=1}^{M}w_m} \in[0,100]\]
  \item Điểm chất lượng là yếu tố then chốt để quyết định thử thách đạt hay không đạt, dựa trên ngưỡng đạt $Q_{\text{threshold}}$ :
    \[
    \text{Kết quả} =
    \begin{cases}
    \text{Thử thách đạt}, & \text{nếu } Q_{\text{challenge}} \geq Q_{\text{threshold}} \\
    \text{Thử thách không đạt}, & \text{nếu } Q_{\text{challenge}} < Q_{\text{threshold}}
    \end{cases}
    \]
  \item Theo thống nhất của nhóm phát triển, ngưỡng đạt ở mức sau là phù hợp với yêu cầu hiện tại của hệ thống, vừa đảm bảo các thử thách có chất lượng tốt, vừa không quá khắt khe để khuyến khích việc đóng góp thử thách vào hệ thống:
    \[Q_{\text{threshold}} = 80 \]
  
\end{itemize}


\subsubsection{Tương tác với hợp đồng khác}

\begin{itemize}
  \item \textbf{ReputationManager}: Cập nhật uy tín sau khi phiên kiểm duyệt chất lượng thử thách kết thúc
  \item \textbf{RoleManager}: Kiểm soát quyền gọi hàm dựa trên chỉ số uy tín của người gọi
  \item \textbf{SolutionManager}: Phối hợp để quản lý thử thách mà người dùng tham gia
  \item \textbf{ChallengeCostManager}: Tính toán khoản token để tham gia thử thách
\end{itemize}

\subsection{ModeratorEscrow}

Hợp đồng \textbf{ModerationEscrow} đóng vai trò như một ``kho quỹ ký gửi'' để tạm giữ khoản token thưởng do người đóng góp nạp vào khi tạo thử thách.
Sau khi thử thách được kiểm duyệt và hợp nhất kết quả, hợp đồng này sẽ tính toán và phân phối phần thưởng cho các người kiểm duyệt phù hợp, dựa trên mức độ chính xác của kết quả kiểm duyệt và uy tín chuyên môn.

\subsubsection{Chức năng chính}

\begin{itemize}
  \item Nhận và lưu trữ token bounty từ người đóng góp
  \item Ghi nhận danh sách người kiểm duyệt tham gia
  \item Đánh giá độ lệch giữa điểm số của từng người kiểm duyệt với điểm số trung bình cuối cùng
  \item Tính trọng số và phân phối phần thưởng công bằng dựa trên uy tín và mức độ chính xác
\end{itemize}

\subsubsection{Các hàm chức năng chính}

\paragraph{Giao tiếp với người đóng góp}

\begin{itemize}
  \item \texttt{depositBounty}: Được gọi bởi \textbf{ChallengeManager} để lưu mức treo thưởng do người đóng góp cung cấp khi gửi thử thách.
\end{itemize}

\paragraph{Giao tiếp với người kiểm duyệt}

\begin{itemize}
  \item \texttt{syncModeratorsFromReviewPool}: Đồng bộ danh sách kiểm duyệt từ \textbf{ChallengeManager} vào \textbf{ModerationEscrow}
  \item \texttt{finalizeChallengePot}: Thực hiện phân phối token sau khi thử thách được duyệt xong
\end{itemize}

% // TODO: ☑️ Giải thích cách phân phối token
\subsubsection{Cơ chế phân phối token}

Khi người đóng góp tạo một thử thách, họ cần chi một khoảng token $B$ để thưởng cho những người kiểm duyệt. Sau quá trình tổng hợp kết quả kiểm duyệt đã trình bày ở phần trước, hệ thống đã tính được điểm chất lượng $Q_{\text{challenge}}$ của thử thách. 
Giả sử $M$ là tập hợp những người kiểm duyệt đánh giá một thử thách. Với mỗi người kiểm duyệt $m \in M$, ta có:
\begin{itemize}
  \item $q_{\text{m}}$ là điểm chất lượng đề xuất của người kiểm duyệt 
  \item $\Delta q_{\text{m}}$ là chênh lệch điểm số giữa điểm chất lượng $Q_{\text{challenge}}$ của thử thách sau kiểm duyệt và điểm chất lượng đề xuất của người kiểm duyệt: 
    \[\Delta q_{\text{m}} = |q_{m}-Q|\]
  \item $R_{m}$ là điểm uy tín chuyên môn của người kiểm duyệt
  \item $B_{m}$ là số token mà người kiểm duyệt được thưởng (nếu đạt yêu cầu)
\end{itemize}

\paragraph{Phân loại dựa trên chênh lệch điểm chất lượng}
\begin{itemize}
  \item Dựa vào chênh lệch điểm chất lượng $\Delta q_{\text{m}}$ của từng người kiếm duyệt và ngưỡng lệch điểm chất lượng $q_{\text{threshold}}$, hệ thống phân loại họ thành hai nhóm: những người kiểm duyệt được thưởng và những người kiểm duyệt không được thưởng. 
    \[
    \text{Người kiếm duyệt} =
    \begin{cases}
      \text{Được thưởng} & \text{nếu } \Delta q_{\text{m}} \leq q_{\text{threshold}} \\
      \text{Không được thưởng} & \text{nếu } \Delta q_{\text{m}} > q_{\text{threshold}}
    \end{cases}
    \]
  \item Theo thống nhất của nhóm phát triển, ngưỡng lệch điểm chất lượng sẽ ở mức sau:
    \[q_{\text{threshold}} = 40 \]

\end{itemize}

\paragraph{Tính trọng số thưởng cho những người kiểm duyệt được thưởng}
\begin{itemize}
  \item Giả sử $\beta$ là hệ số phản ánh mức độ ảnh hưởng của điểm uy tín chuyên môn đối với trọng số thường ($\beta \in [0,1]$), $\alpha$ là hệ số phản ánh mức độ giảm giá trị thưởng theo chênh lệch điểm chất lượng, ($\alpha \in (0, +\infty)$). Trọng số thưởng của người kiểm duyệt $m$ được tính theo công thức: 
    \[w_m = R_m^{\beta}\;\cdot\;e^{-\alpha\,\Delta q_{\text{m}}} \]

  \item Công thức trọng số thưởng là một hàm kết hợp dựa trên hai yếu tố: điểm uy tín chuyên môn và chênh lệch điểm chất lượng của người kiểm duyệt (độ chính xác).
  \item Tham số $\beta \in [0, 1]$ điều chỉnh mức độ ảnh hưởng của uy tín tới trọng số thưởng. 
  \begin{itemize}
    \item Nếu $\beta$ lớn ($\beta$ gần 1), điểm uy tín chuyên môn sẽ có ảnh hưởng nhiều hơn đến trọng số thưởng. Từ đó, người kiểm duyệt có điểm uy tín cao sẽ được nhận thưởng nhiều hơn.
    \item Nếu $\beta$ nhỏ ($\beta$ gần 0), điểm uy tín chuyên môn sẽ có ảnh hưởng không đáng kể đến trọng số, nghĩa là yếu tố chính xác (thể hiện qua chênh lệch điểm chất lượng $\Delta q_{\text{m}}$) sẽ chiếm vai trò chủ đạo.
  \end{itemize}
  \item Tham số $\alpha$ có tác dụng kiểm soát tốc độ giảm của trọng số thưởng dựa trên chênh lệch điểm chất lượng:
    \begin{itemize}
      \item Nếu $\alpha$ lớn, trọng số thưởng sẽ giảm rất nhanh khi chênh lệch điểm chất lượng tăng lên, nghĩa là phần lớn token thưởng được phát cho những người đánh giá chính xác nhất.
      \item Nếu $\alpha$ nhỏ, trọng số thưởng giảm chậm hơn khi chênh lệch điểm chất lượng tăng lên, nghĩa là số token thưởng sẽ được phân phát đều hơn cho những người kiểm duyệt.
    \end{itemize}
\end{itemize}


\paragraph{Phân phối phần thưởng}
\begin{itemize}
  \item Quỹ thưởng chính là số token thưởng $B$ mà người đóng góp chi ra để thưởng cho những người kiểm duyệt
  \item Giả sử $M_{\text{reward}}$ là tập hợp những người kiểm duyệt được thưởng. Phần thưởng mà mỗi người kiểm duyệt nhận được là:
    \[B_m = \frac{w_m}{\sum_{m}^{M_{\text{reward}}}w_m} B\] 
\end{itemize}

\subsubsection{Tương tác với hợp đồng khác}

\begin{itemize}
  \item \textbf{ReputationManager}: Truy xuất thông tin uy tín của kiểm duyệt viên
  \item \textbf{ChallengeManager}: Hỗ trợ phân phối thưởng khi phiên kiểm duyệt hoàn tất
\end{itemize}

\subsection{ChallengeCostManager}

Hợp đồng \textbf{ChallengeCostManager} đảm nhiệm việc tính toán, thu thập và chuyển giao token phí từ người tham gia thử thách đến người đóng góp thử thách.
Nó giúp đảm bảo sự khuyến khích kinh tế rõ ràng cho người tạo nội dung và điều chỉnh giá trị tham gia dựa trên độ khó và chất lượng.

\subsubsection{Chức năng chính}

\begin{itemize}
  \item Tính phí tham gia thử thách
  \item Xử lý thanh toán từ người tham gia đến contributor khi đăng ký tham gia thử thách
  \item Ghi nhận tổng doanh thu và thông tin thanh toán theo từng thử thách
\end{itemize}

\subsubsection{Các hàm chức năng chính}

\begin{itemize}
  \item \texttt{\_computeCost}: tính lượng token để tham gia thử thách
  \item \texttt{addTalentPayment}: gửi token từ người tham gia cho người đóng góp và ghi nhận người tham gia đối với thử thách này
\end{itemize}

% // TODO: ☑️ Giải thích cách tính phí tham gia
\subsubsection{Công thức tính phí}

Giả sử: 
\begin{itemize}
  \item $F_{\min}$, $F_{\max}$ là phí sàn và phí trần (native token - POL)
  \item $\alpha$ là hằng số phản ánh mức độ ảnh hưởng của độ mức độ khó đối với phí tham gia ($0<\alpha<1$) 
  \item $\beta$ là hằng số phản ánh mức độ ảnh hưởng của chất lượng đối với phí tham gia ($0<\beta<1$)
  \item $W_{\text{difficulty}}$ là trọng số độ khó
    \[
      W_{\text{difficulty}} =
      \begin{cases}
        1   & , \text{nếu độ khó là dễ}         \\
        2   & , \text{nếu độ khó là trung bình} \\
        3   & , \text{nếu độ khó là khó}        \\
      \end{cases}
    \]
  \item $Q_{\text{challenge}}$ là điểm chất lượng của thử thách sau kiểm duyệt, được chuẩn hoá $[0,1]$
  \item $\gamma$ là hằng số phản ánh tỷ lệ hoàn vốn ($0 < \gamma \le 1$)
  \item $B$ là số lượng token người đóng góp chi ra để thưởng cho những người kiếm duyệt 
  \item $E$ là số lượt người dùng tham gia vào thử thách kỳ vọng
  \item $n_i$ là số lượt người dùng đã tham gia vào thử thách trước người chơi thứ $i$
  \item $\beta$ là tham số phản ảnh tốc độ suy giảm chi phí tham gia thử thách khi số lượng người chơi tăng lên
\end{itemize}

\paragraph{Tính phí tham gia thử thách}
\begin{itemize}
  \item Phí tham gia thử gồm hai thành phần: phí cơ sở và phí hoàn vốn
  \item Phí cơ sở được tình bằng một hàm tuyến tính dựa trên phí sàn, độ khó của thử thách và điểm chất lượng của thử thách: 
    \[F_{\text{base}}= F_{\min}+ \alpha\,W_d + \beta\,Q\]
  \item Phí hoàn vốn là mức phí tính thêm cho những người đầu tiên tham gia vào thử thách, giảm dần về 0 khi càng nhiều người tham gia vào thử thách. Mức phí này hỗ trợ người đóng góp hoàn lại số vốn đã chi khi đóng góp thử thách: 
    \[F_{\mathrm{bonus}}= \gamma\,\frac{B}E\;e^{-\beta\,n_i}\]
  \item Phí tham gia thử thách của người tham gia thứ $i$ được tính bằng công thức sau, phụ thuộc vào phí cơ sở và phí hoàn vốn. Tuy nhiên, mức phí này bị ràng buộc giới hạn trên $F_{\max}$ và giới hạn dưới $F_{\min}$ để đảm bảo quyền lợi của người dùng khi tham gia thử thách:
    \[F_{i} =
    \begin{cases}
      F_{\min}, 
      & \text{nếu } F_{\mathrm{base}} + F_{\mathrm{bonus}} < F_{\min}, \\[6pt]
      F_{\mathrm{base}} + F_{\mathrm{bonus}}, 
      & \text{nếu } F_{\min} \le F_{\mathrm{base}} + F_{\mathrm{bonus}} \le F_{\max}, \\[6pt]
      F_{\max}, 
      & \text{nếu } F_{\mathrm{base}} + F_{\mathrm{bonus}} > F_{\max}.
    \end{cases}
    \] 
\end{itemize}

\paragraph{Các giá trị hằng số đề xuất} 

Bảng sau đây liệt kê các giá trị hằng số được đề xuất cho công thức tính phí tham gia thử thách:

\begin{table}[H]
\centering
  \begin{tabular}{|c|c|}
  \hline
  \textbf{Ký hiệu} & \textbf{Giá trị đề xuất} \\
  \hline 
  $F_{\text{base}}$ & 0.01 POL \\
  \hline
  $F_{\max}$ & 0.05 POL \\
  \hline
  $\alpha$ & 0.6 \\
  \hline
  $\beta$ & 0.8 \\
  \hline
  $\gamma$ & 0.3 \\
  \hline
  $E$ & 30 \\
  \hline
  \end{tabular}
\end{table}

\subsubsection{Tương tác với hợp đồng khác}

\begin{itemize}
  \item \textbf{ChallengeManager}: Hỗ trợ tính phí tham gia thử thách
  \item \textbf{ModeratorEscrow}: Dùng để lấy mức treo thưởng, phục vụ cho tính phí động
\end{itemize}

\subsection{SolutionManager}

Hợp đồng \textbf{SolutionManager} chịu trách nhiệm ghi nhận toàn bộ quy trình người dùng tham gia thử thách, nộp giải pháp, đưa vào hệ thống đánh giá, cũng như tổng hợp kết quả đánh giá và cập nhật điểm uy tín.

\subsubsection{Chức năng chính}

\begin{itemize}
  \item Quản lý thông tin giải pháp của người dùng đối với mỗi thử thách
  \item Điều phối quá trình đánh giá giải pháp bằng cách tổ chức một phiên đánh giá gồm các người đánh giá
  \item Tính điểm trung bình có trọng số cho giải pháp, cập nhật tiến độ, lưu trữ điểm số và cập nhật điểm uy tín cho người giải và những người đánh giá
\end{itemize}

\subsubsection{Cấu trúc dữ liệu chính}

\begin{itemize}
  \item \texttt{Solution}: Chứa thông tin đầy đủ của một giải pháp
  \item \texttt{Evaluation}: Ghi nhận điểm số của người đánh giá đối với một giải pháp
  \item \texttt{EvaluationPool}: Tập hợp những người đánh giá tham gia vào một giải pháp và trạng thái đánh giá
\end{itemize}

\subsubsection{Các hàm chức năng chính}

\paragraph{Người dùng tham gia thử thách}

\begin{itemize}
  \item \texttt{createSolutionBase}: Ghi nhận hành vi tham gia thử thách và khởi tạo không gian giải pháp
\end{itemize}

\paragraph{Nộp và chuyển trạng thái giải pháp}

\begin{itemize}
  \item \texttt{submitSolution}: Người dùng nộp bài (không chỉnh sửa được nữa).
  \item \texttt{putSolutionUnderReview}: Chuyển giải pháp sang trạng thái chờ đánh giá và khởi tạo một phiên đánh giá.
\end{itemize}

\paragraph{Quản lý phiên đánh giá}

\begin{itemize}
  \item \texttt{evaluatorJoinSolution}: Cho phép người đánh giá tham gia đánh giá giải pháp
  \item \texttt{evaluatorSubmitScore}: Gửi điểm đánh giá
  \item \texttt{finalizeEvaluation}: Khi ghi nhận đủ điểm đánh giá, tính toán điểm giáp pháp cuối cùng và cập nhật uy tín cho người giải và những người đánh giá
\end{itemize}

% // TODO: ☑️ Giải thích cách tính điểm đánh giá
\subsubsection{Cơ chế tổng hợp điểm đánh giá}

Sau khi người dùng nộp bài giải cho một thử thách, một phiên đánh giá sẽ được kích hoạt. Một số chuyên gia đánh giá sẽ tham gia phiên này và đưa ra điểm số cho bài giải. Điểm số cuối cùng của bài giải được tính theo công thức sau:

\[
S_{\text{solution}}= \frac{\displaystyle\sum_{i=1}^{n} (W_{i} \cdot s_{i})}{\displaystyle\sum_{i=1}^{n} W_{i}}
\]

Trong đó:

\begin{itemize}
  \item $S_{\text{solution}}$: Là điểm số cuối cùng của bài giải, với giá trị nằm trong khoảng $[0, 100]$.
  \item $s_{i}$: Là điểm số mà người đánh giá thứ $i$ chấm cho bài giải, với giá trị nằm trong khoảng $[0, 100]$.
  \item $n$: Là tổng số người đánh giá tham gia phiên đánh giá.
  \item $W_{i}$: Là trọng số thể hiện uy tín của người đánh giá thứ $i$ trong \textbf{lĩnh vực của thử thách}, được xác định theo công thức:
  \[
  W_{i} = R_{i}
  \]
  Trong đó $R_{i}$ là điểm uy tín chuyên môn của người đánh giá thứ $i$ trong lĩnh vực của thử thách.
\end{itemize}

\subsubsection{Tương tác với hợp đồng khác}

\begin{itemize}
  \item \textbf{ReputationManager}: Cập nhật uy tín sau khi phiên đánh giá giải pháp kết thúc
  \item \textbf{ChallengeManager}: Phối hợp để quản lý thử thách mà người dùng đã tham gia
  \item \textbf{RoleManager}: Kiểm soát quyền gọi hàm
\end{itemize}

% // TODO: Giải thích về hợp đồng nếu cần thiết
\subsection{RecruiterSubscription}

\section{Luồng hoạt động hệ thống}

\subsection{Luồng đóng góp thử thách}

\begin{figure}[H]
  \centering
  \includegraphics[width=0.9\textwidth]{system-workflow/contribute-challenge-flow.png}
  \caption{Luồng đóng góp thử thách}
  \label{fig:contribute-challenge-flow}
\end{figure}

\subsection{Luồng kiểm duyệt thử thách}

\begin{figure}[H]
  \centering
  \includegraphics[width=0.99\textwidth]{system-workflow/moderate-challenge-flow.png}
  \caption{Luồng kiểm duyệt thử thách}
  \label{fig:moderate-challenge-flow}
\end{figure}

\subsection{Luồng thực hiện thử thách}

\begin{figure}[H]
  \centering
  \includegraphics[width=0.99\textwidth]{system-workflow/join-challenge-flow.png}
  \caption{Luồng thực hiện thử thách}
  \label{fig:join-challenge-flow}
\end{figure}

\subsection{Luồng đánh giá giải pháp}

\begin{figure}[H]
  \centering
  \includegraphics[width=0.99\textwidth]{system-workflow/evaluate-solution-flow.png}
  \caption{Luồng đánh giá giải pháp}
  \label{fig:evaluate-solution-flow}
\end{figure}